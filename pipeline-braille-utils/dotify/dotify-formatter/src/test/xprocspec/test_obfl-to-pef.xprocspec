<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:dotify="http://code.google.com/p/dotify/"
               script="http://www.daisy.org/pipeline/modules/braille/dotify-calabash/library.xpl">
  
  <x:scenario label="test_01">
    <x:call step="dotify:obfl-to-pef">
      <x:input port="source">
        <x:document type="inline">
          <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und">
            <layout-master name="a" page-width="15" page-height="15" duplex="false">
              <default-template>
                <header/>
                <footer/>
              </default-template>
            </layout-master>
            <sequence master="a">
              <block>
                ⠤⠤⠤
              </block>
            </sequence>
          </obfl>
        </x:document>
      </x:input>
      <x:option name="locale" select="'und'"/>
      <x:option name="mode" select="'dotify:format'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="valid" type="validate" grammar="relax-ng">
      <x:document type="file" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/schema/pef-2008-1.rng"/>
    </x:expect>
    <x:expect label="valid" type="validate" grammar="schematron">
      <x:document type="file" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/schema/pef-2008-1.sch"/>
    </x:expect>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <!--
      page-number
  -->
  <x:scenario label="test_02">
    <x:call step="dotify:obfl-to-pef">
      <x:input port="source">
        <x:document type="inline">
          <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und">
            <layout-master name="a" duplex="false" page-width="40" page-height="25">
              <default-template>
                <header/>
                <footer/>
              </default-template>
            </layout-master>
            <sequence master="a">
              <block>
                <page-number ref-id="x" style="default"/>
              </block>
              <block break-before="page" id="x">
                ⠤⠤⠤
              </block>
            </sequence>
          </obfl>
        </x:document>
      </x:input>
      <x:option name="locale" select="'und'"/>
      <x:option name="mode" select="'dotify:format'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="valid" type="validate" grammar="relax-ng">
      <x:document type="file" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/schema/pef-2008-1.rng"/>
    </x:expect>
    <x:expect label="valid" type="validate" grammar="schematron">
      <x:document type="file" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/schema/pef-2008-1.sch"/>
    </x:expect>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠼⠃</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_03" pending="issue with cross-referening between sequences">
    <x:call step="dotify:obfl-to-pef">
      <x:input port="source">
        <x:document type="inline">
          <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und">
            <layout-master name="a" duplex="false" page-width="40" page-height="25">
              <default-template>
                <header/>
                <footer/>
              </default-template>
            </layout-master>
            <sequence master="a">
              <block>
                <page-number ref-id="x" style="default"/>
              </block>
            </sequence>
            <sequence>
              <block id="x">
                ⠤⠤⠤
              </block>
            </sequence>
          </obfl>
        </x:document>
      </x:input>
      <x:option name="locale" select="'und'"/>
      <x:option name="mode" select="'dotify:format'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="valid" type="validate" grammar="relax-ng">
      <x:document type="file" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/schema/pef-2008-1.rng"/>
    </x:expect>
    <x:expect label="valid" type="validate" grammar="schematron">
      <x:document type="file" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/schema/pef-2008-1.sch"/>
    </x:expect>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠼⠃</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <!--
      leader
  -->
  <x:scenario label="test_04" pending="issue with leader">
    <x:call step="dotify:obfl-to-pef">
      <x:input port="source">
        <x:document type="inline">
          <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und">
            <layout-master name="a" duplex="false" page-width="10" page-height="25">
              <default-template>
                <header/>
                <footer/>
              </default-template>
            </layout-master>
            <sequence master="a">
              <block id="chapter_1">⠤</block>
              <block>
                <leader pattern="⠄" position="100%" align="right"/>⠀<page-number ref-id="chapter_1" style="default"/>
              </block>
            </sequence>
          </obfl>
        </x:document>
      </x:input>
      <x:option name="locale" select="'und'"/>
      <x:option name="mode" select="'dotify:format'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="25" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤</row>
                  <row>⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <!--
      collection
  -->
  <x:scenario label="test_05">
    <x:call step="dotify:obfl-to-pef">
      <x:input port="source">
        <x:document type="inline">
          <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und">
            <layout-master name="body" duplex="false" page-width="10" page-height="8">
              <default-template>
                <header/>
                <footer/>
              </default-template>
              <page-area align="bottom" max-height="5" collection="footnotes">
                <before><leader position="100%" pattern="⠒"/></before>
              </page-area>
            </layout-master>
            <collection name="footnotes">
              <item id="a">
                <block>⠶</block>
              </item>
              <item id="b">
                <block>⠶⠶</block>
              </item>
              <item id="c">
                <block>⠶⠶⠶</block>
              </item>
            </collection>
            <sequence master="body">
              <block>
                ⠿⠿⠿
                <anchor item="a"/>
                ⠿⠿⠿
                <anchor item="b"/>
              </block>
              <block break-before="page">
                ⠿⠿⠿
              </block>
              <block break-before="page">
                ⠿⠿⠿
                <anchor item="c"/>
              </block>
            </sequence>
          </obfl>
        </x:document>
      </x:input>
      <x:option name="locale" select="'und'"/>
      <x:option name="mode" select="'dotify:format'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="8" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠶</row>
                  <row>⠶⠶</row>
                </page>
                <page>
                  <row>⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠶⠶⠶</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
</x:description>
